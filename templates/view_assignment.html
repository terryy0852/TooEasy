{% extends "base.html" %}

{% block title %}{{ assignment.title }} - {{ _('作业管理系统') }}{% endblock %}

{% block content %}
    <div class="flex justify-between align-center mb-2">
        <h2 style="color: var(--primary-color);">{{ assignment.title }}</h2>
        <a href="{{ url_for('student_dashboard', lang=request.args.get('lang')) }}" class="btn btn-outline">{{ _('返回仪表盘') }}</a>
    </div>
    
    <div class="assignment-detail">
        <div class="assignment-meta">
            <span>{{ _('发布者') }}: {{ assignment.creator.username }}</span>
            {% if assignment.due_date %}
                <span>{{ _('截止日期') }}: {{ assignment.due_date.strftime('%Y-%m-%d') }}</span>
            {% endif %}
            <span>{{ _('发布时间') }}: {{ assignment.created_at.strftime('%Y-%m-%d') }}</span>
        </div>
        
        <div class="assignment-description">
            {{ assignment.description }}
        </div>
        
        {% if assignment.file_path %}
            <div style="margin-bottom: 1.5rem;">
                <a href="{{ url_for('download_file', filename=assignment.file_path) }}" class="btn btn-outline">
                    {{ _('下载文件') }}
                </a>
            </div>
        {% endif %}
        
        {% if submission %}
            <div class="card" style="background-color: #f0f8ff;">
                <h3 style="color: var(--primary-color); margin-bottom: 1rem;">{{ _('Submission Status') }}</h3>
                <p>{{ _('Submitted At') }}: {{ submission.submitted_at.strftime('%Y-%m-%d %H:%M') }}</p>
                <p>{{ _('Submitted File') }}: <a href="{{ url_for('download_file', filename=submission.file_path) }}" style="color: var(--primary-color);">{{ _('Download') }}</a></p>
                
                {% if submission.is_graded %}
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
                        <h4 style="color: var(--secondary-color); margin-bottom: 0.5rem;">{{ _('Grading Feedback') }}</h4>
                        <p style="margin-bottom: 0.5rem;">{{ _('Score') }}: <strong>{{ submission.grade }}</strong></p>
                        {% if submission.feedback %}
                            <p>{{ _('Feedback') }}: {{ submission.feedback }}</p>
                        {% else %}
                            <p>{{ _('No feedback') }}</p>
                        {% endif %}
                    </div>
                {% else %}
                    <p style="margin-top: 1rem; color: #666;">{{ _('Not graded yet') }}</p>
                {% endif %}
            </div>
        {% else %}
            <div style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">{{ _('Submit Assignment') }}</h3>
                
                <!-- Interactive Assignment Option -->
                {% if assignment.file_path and (assignment.file_path.endswith('.html') or assignment.file_path.endswith('.htm')) %}
                    <div style="margin-bottom: 2rem;">
                        <button type="button" 
                                class="btn btn-primary" 
                                onclick="window.open('{{ url_for('start_interactive_assignment', assignment_id=assignment.id) }}', '_blank');">{{ _('开始作业') }}</button>
                        <p style="color: #666; font-size: 0.875rem; margin-top: 0.5rem;">
                            {{ _('点击上面的按钮，在新标签页中完成互动作业') }}
                        </p>
                    </div>
                {% endif %}
                
                <!-- File Upload Option -->
                <form method="POST" enctype="multipart/form-data" action="{{ url_for('submit_assignment', assignment_id=assignment.id) }}">
                    <div class="form-group">
                        <label for="file">{{ _('Upload assignment file') }}</label>
                        <input type="file" id="file" name="file" required>
                        <p style="color: #666; font-size: 0.875rem; margin-top: 0.5rem;">
                            {{ _('Supported formats: txt, pdf, doc, docx, xls, xlsx, ppt, pptx, zip, html, htm') }}
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">{{ _('Submit Assignment') }}</button>
                    </div>
                </form>
            </div>
        {% endif %}
    </div>
{% endblock %}