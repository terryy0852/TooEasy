{% extends "base.html" %}

{% block title %}{{ _('Grade') }} - {{ submission.assignment.title }}{% endblock %}

{% block content %}
    <h2 style="color: var(--primary-color);">{{ _('Grade Assignment') }}: {{ submission.assignment.title }}</h2>
    <p>{{ _('Submitted by') }}: {{ submission.student.username }}</p>
    <p>{{ _('Submitted At') }}: {{ submission.submitted_at.strftime('%Y-%m-%d %H:%M') }}</p>
    <a href="{{ url_for('download_file', filename=submission.file_path) }}" class="btn btn-outline">{{ _('Download Assignment') }}</a>

    {% if submission.file_path and (submission.file_path.lower().endswith('.html') or submission.file_path.lower().endswith('.htm')) %}
        <div style="margin: 1rem 0;">
            <h3 style="margin-bottom: .5rem;">{{ _('Student Assignment Content (HTML)') }}</h3>
            <div class="flex gap-1" style="margin-bottom: .5rem;">
                <a href="{{ url_for('serve_submission_content', filename=submission.file_path) }}" target="_blank" class="btn btn-secondary">{{ _('Open in new tab') }}</a>
            </div>
            <iframe src="{{ url_for('serve_submission_content', filename=submission.file_path) }}" width="100%" height="600px" style="border: 1px solid #ddd; border-radius: var(--border-radius);"></iframe>
        </div>
    {% elif submission.file_path and submission.file_path.lower().endswith('.json') %}
        <div style="margin: 1rem 0;">
            <h3 style="margin-bottom: .5rem;">{{ _('Student Assignment Content (JSON)') }}</h3>
            <pre style="background: #f7f7f7; padding: 1rem; border-radius: var(--border-radius); white-space: pre-wrap; word-wrap: break-word;">{{ answers_pretty }}</pre>
        </div>
    {% endif %}

    <form method="post">
        <div class="form-group">
            <label for="grade">{{ _('Score') }}</label>
            <input type="text" name="grade" id="grade" class="form-control" value="{{ submission.grade or '' }}">
        </div>
        <div class="form-group">
            <label for="feedback">{{ _('Feedback') }}</label>
            <textarea name="feedback" id="feedback" class="form-control">{{ submission.feedback or '' }}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">{{ _('Submit Grade') }}</button>
    </form>
{% endblock %}